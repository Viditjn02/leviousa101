# electron-builder.yml

# The unique application ID
appId: com.leviousa.app

# The user-facing application name
productName: Leviousa

# Publish configuration for GitHub releases
publish:
    provider: github
    owner: Viditjn02
    repo: leviousa101
    releaseType: draft

# Protocols configuration for deep linking
protocols:
    name: Leviousa Protocol
    schemes: 
        - leviousa

# List of files to be included in the app package
files:
    - src/**/*
    - package.json
    - leviousa_web/backend_node/**/*
    - '!**/node_modules/electron/**'
    - public/build/**/*

# Additional resources to be copied into the app's resources directory
extraResources:
    - from: leviousa_web/.next
      to: .next
      filter: ["**/*"]

asarUnpack:
    - "src/ui/assets/SystemAudioDump"
    - "**/node_modules/sharp/**/*"
    - "**/node_modules/@img/**/*"
    - "**/node_modules/better-sqlite3/**/*"
    - "**/node_modules/keytar/**/*"

# Windows configuration
win:
    icon: src/ui/assets/logo.ico
    target:
        - target: nsis
          arch: x64
        - target: portable
          arch: x64
    requestedExecutionLevel: asInvoker
    signAndEditExecutable: true
    cscLink: build\certs\glass-dev.pfx
    cscKeyPassword: "${env.CSC_KEY_PASSWORD}"
    signtoolOptions:
      certificateSubjectName: "Glass Dev Code Signing"

# NSIS installer configuration for Windows
nsis:
    oneClick: false
    perMachine: false
    allowToChangeInstallationDirectory: true
    deleteAppDataOnUninstall: true
    createDesktopShortcut: always
    createStartMenuShortcut: true
    shortcutName: Leviousa

# macOS specific configuration
mac:
    # The application category type
    category: public.app-category.utilities
    # Path to the .icns icon file
    icon: src/ui/assets/logo.icns
    # Minimum macOS version (supports both Intel and Apple Silicon)
    minimumSystemVersion: '11.0'
    hardenedRuntime: true
    gatekeeperAssess: false
    entitlements: entitlements.plist
    entitlementsInherit: entitlements.plist
    # Code signing with Developer ID - Apple's official process
    type: "distribution"  # Distribution for signed releases
    identity: "Vidit Jain (8LNUMP84V8)"  # Your actual certificate (prefix removed as per electron-builder requirement)
    # signIgnore patterns removed to fix regex errors - will sign everything
    # Notarization disabled for local testing
    notarize: false
    target:
      - target: dmg
        arch: universal  # Universal binary for both architectures
      - target: zip
        arch: universal

# DMG specific configuration
dmg:
    sign: true  # Sign the DMG installer
    title: "Leviousa"
    backgroundColor: "#1a1a1a"
    contents:
        - x: 130
          y: 220
          type: "file"
        - x: 410  
          y: 220
          type: "link"
          path: "/Applications"
    window:
        x: 400
        y: 100
        width: 540
        height: 380

# Additional configuration for native modules
buildDependenciesFromSource: true

# Ensure proper permissions (notarization disabled for local testing)
# afterSign: scripts/notarize.js
